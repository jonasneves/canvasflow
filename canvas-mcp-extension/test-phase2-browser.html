<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Phase 2 Browser Test</title>
  <style>
    body {
      font-family: system-ui, -apple-system, sans-serif;
      max-width: 800px;
      margin: 40px auto;
      padding: 20px;
      background: #F9FAFB;
    }
    h1 {
      color: #111827;
    }
    .test-section {
      background: white;
      padding: 20px;
      margin: 20px 0;
      border-radius: 8px;
      border: 1px solid #E5E7EB;
    }
    .test-result {
      padding: 8px 12px;
      margin: 4px 0;
      border-radius: 4px;
      font-family: 'Courier New', monospace;
      font-size: 13px;
    }
    .success {
      background: #D1FAE5;
      color: #065F46;
    }
    .error {
      background: #FEE2E2;
      color: #991B1B;
    }
    .info {
      background: #E0F2FE;
      color: #075985;
    }
  </style>
</head>
<body>
  <h1>ðŸ§ª Phase 2 Browser Test</h1>
  <p>Testing structured outputs schemas and mappers in browser environment.</p>

  <div id="results"></div>

  <!-- Load the browser-compatible scripts -->
  <script src="ai-schemas-browser.js"></script>
  <script src="ai-mappers-browser.js"></script>

  <script>
    const results = document.getElementById('results');

    function addSection(title) {
      const section = document.createElement('div');
      section.className = 'test-section';
      section.innerHTML = `<h3>${title}</h3>`;
      results.appendChild(section);
      return section;
    }

    function addResult(section, message, type = 'success') {
      const result = document.createElement('div');
      result.className = `test-result ${type}`;
      result.textContent = message;
      section.appendChild(result);
    }

    // Test 1: Check if global objects are loaded
    const section1 = addSection('Test 1: Global Objects Loaded');
    if (typeof window.AISchemas !== 'undefined') {
      addResult(section1, 'âœ“ window.AISchemas is defined');
    } else {
      addResult(section1, 'âœ— window.AISchemas is NOT defined', 'error');
    }

    if (typeof window.AIMappers !== 'undefined') {
      addResult(section1, 'âœ“ window.AIMappers is defined');
    } else {
      addResult(section1, 'âœ— window.AIMappers is NOT defined', 'error');
    }

    // Test 2: Schema Structure
    const section2 = addSection('Test 2: Schema Structure');
    if (window.AISchemas.SIDEPANEL_INSIGHTS_SCHEMA) {
      addResult(section2, 'âœ“ SIDEPANEL_INSIGHTS_SCHEMA exists');
      addResult(section2, `  Type: ${window.AISchemas.SIDEPANEL_INSIGHTS_SCHEMA.type}`, 'info');
      addResult(section2, `  Has schema.properties: ${!!window.AISchemas.SIDEPANEL_INSIGHTS_SCHEMA.schema.properties}`, 'info');
    } else {
      addResult(section2, 'âœ— SIDEPANEL_INSIGHTS_SCHEMA not found', 'error');
    }

    // Test 3: Urgency Mappings
    const section3 = addSection('Test 3: Urgency Score Mappings');
    for (let score = 0; score <= 3; score++) {
      const color = window.AIMappers.mapUrgencyToColor(score);
      const label = window.AIMappers.mapUrgencyToDisplayLabel(score);
      const valid = window.AIMappers.isValidUrgencyScore(score);
      addResult(section3, `Score ${score}: ${label.padEnd(10, ' ')} â†’ ${color} (valid: ${valid})`, 'info');
    }

    // Test 4: Intensity Mappings
    const section4 = addSection('Test 4: Intensity Score Mappings');
    for (let score = 0; score <= 3; score++) {
      const color = window.AIMappers.mapIntensityToColor(score);
      const label = window.AIMappers.mapIntensityToLabel(score);
      const valid = window.AIMappers.isValidIntensityScore(score);
      addResult(section4, `Score ${score}: ${label.padEnd(12, ' ')} â†’ ${color} (valid: ${valid})`, 'info');
    }

    // Test 5: Sample Response Structure
    const section5 = addSection('Test 5: Sample Response Formatting');
    const sampleResponse = {
      priority_tasks: [
        {
          task: "Complete Art History essay",
          reason: "Due tomorrow, worth 20% of grade",
          urgency_score: 3,
          estimated_hours: 4.5
        },
        {
          task: "Study for CS midterm",
          reason: "Exam in 3 days, covers complex algorithms",
          urgency_score: 2,
          estimated_hours: 6
        }
      ],
      workload_assessment: {
        overall: "Heavy week with multiple high-priority deadlines",
        total_hours_needed: 18.5,
        intensity_score: 2,
        recommendations: [
          "Focus on the essay first due to immediate deadline",
          "Block 2-hour study sessions for CS",
          "Take short breaks every hour"
        ]
      },
      study_tips: [
        "Use pomodoro technique for sustained focus",
        "Create visual timelines for art history content",
        "Practice coding problems incrementally"
      ]
    };

    addResult(section5, `Priority tasks: ${sampleResponse.priority_tasks.length}`, 'info');
    sampleResponse.priority_tasks.forEach((task, i) => {
      const color = window.AIMappers.mapUrgencyToColor(task.urgency_score);
      const label = window.AIMappers.mapUrgencyToDisplayLabel(task.urgency_score);
      addResult(section5, `  Task ${i+1}: ${label} (${color}) - ${task.estimated_hours}h`, 'info');
    });

    const intensityColor = window.AIMappers.mapIntensityToColor(sampleResponse.workload_assessment.intensity_score);
    const intensityLabel = window.AIMappers.mapIntensityToLabel(sampleResponse.workload_assessment.intensity_score);
    addResult(section5, `Workload intensity: ${intensityLabel} (${intensityColor})`, 'info');
    addResult(section5, `Total hours: ${sampleResponse.workload_assessment.total_hours_needed}h`, 'info');

    // Test 6: Invalid Input Handling
    const section6 = addSection('Test 6: Invalid Input Handling');
    const invalidScore = 10;
    const defaultLabel = window.AIMappers.mapUrgencyToDisplayLabel(invalidScore);
    addResult(section6, `Invalid urgency score (${invalidScore}): ${defaultLabel} (should default to 'Medium')`,
              defaultLabel === 'Medium' ? 'success' : 'error');

    const negativeScore = -1;
    const negativeValid = window.AIMappers.isValidUrgencyScore(negativeScore);
    addResult(section6, `Negative score validation (${negativeScore}): ${negativeValid} (should be false)`,
              negativeValid === false ? 'success' : 'error');

    // Summary
    const summary = addSection('Summary');
    addResult(summary, 'âœ“ All browser-compatible scripts loaded successfully', 'success');
    addResult(summary, 'âœ“ Mappers working correctly with numeric scores', 'success');
    addResult(summary, 'âœ“ Sample response structure validated', 'success');
    addResult(summary, 'âœ“ Ready for integration with sidepanel.js', 'success');
  </script>
</body>
</html>
