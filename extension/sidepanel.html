<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="colors.css">
  <link rel="stylesheet" href="sidepanel.css">
</head>
<body>
  <div class="header">
    <div class="header-left">
      <div class="header-icon">
        <img src="icon-48.png" alt="CanvasFlow" style="width: 35px; height: 35px;">
      </div>
      <h1 class="title">CanvasFlow</h1>
    </div>
    <div class="header-right">
      <button class="btn-icon" id="focusModeBtn" title="Focus Mode: Show only top 3 priorities">
        <i data-lucide="target"></i>
      </button>
      <button class="btn-icon" id="openDashboardBtn" title="Open weekly schedule">
        <i data-lucide="calendar"></i>
      </button>
      <button class="btn-icon" id="settingsBtn" title="Settings">
        <i data-lucide="settings"></i>
      </button>
    </div>
  </div>

  <div class="tab-nav">
    <button class="tab-button active" data-tab="canvas-data">Dashboard</button>
    <button class="tab-button" data-tab="ai-dashboard">Study Planner</button>
  </div>

  <!-- Canvas URL Configuration Banner -->
  <div class="config-banner" id="configBanner" style="display: none;">
    <div class="config-banner-content">
      <div class="config-banner-icon">
        <i data-lucide="info"></i>
      </div>
      <div class="config-banner-text">
        <div class="config-banner-title">Canvas URL Not Configured</div>
        <div class="config-banner-message">Configure your Canvas instance URL to start using CanvasFlow</div>
      </div>
      <button class="config-banner-btn" id="openConfigSettings">
        Configure Now
      </button>
      <button class="config-banner-close" id="closeConfigBanner" title="Dismiss">
        <i data-lucide="x"></i>
      </button>
    </div>
  </div>

  <!-- Canvas Data Tab -->
  <div class="tab-content active" id="canvas-data">
    <!-- Summary Cards -->
    <div class="summary-cards">
      <div class="summary-card overdue" data-filter="overdue">
        <div class="summary-value" id="overdueCount">-</div>
        <div class="summary-label">Overdue</div>
      </div>
      <div class="summary-card due-today" data-filter="due-today">
        <div class="summary-value" id="dueTodayCount">-</div>
        <div class="summary-label">Due Today</div>
      </div>
      <div class="summary-card upcoming" data-filter="upcoming">
        <div class="summary-value" id="upcomingCount">-</div>
        <div class="summary-label">Upcoming</div>
      </div>
    </div>

    <div class="assignments-section">
      <div class="section-header">
        <span id="assignmentsSectionTitle" style="display: flex; align-items: center; gap: 8px;">
          <i id="assignmentsSectionIcon" data-lucide="clock" style="width: 18px; height: 18px;"></i>
          <span id="assignmentsSectionText">Due Today</span>
        </span>
        <button id="toggleGradesBtn" class="btn-icon" title="Toggle grade visibility">
          <i id="gradesEyeIcon" data-lucide="eye-off"></i>
        </button>
      </div>
      <div id="assignmentsList">
        <div class="loading">
          <span class="spinner"></span>
          Loading assignments...
        </div>
      </div>
    </div>
  </div>

  <!-- AI Dashboard Tab -->
  <div class="tab-content" id="ai-dashboard">
    <!-- View Toggle Tabs -->
    <div class="ai-view-tabs">
      <button class="ai-view-tab active" data-view="list">
        <i data-lucide="list"></i>
        <span>List View</span>
      </button>
      <button class="ai-view-tab" data-view="calendar">
        <i data-lucide="calendar"></i>
        <span>Calendar View</span>
      </button>
    </div>

    <!-- List View Content -->
    <div class="ai-view-content" id="listViewContent">
      <div class="ai-header-card">
        <div class="ai-header-card-inner">
          <div class="ai-header-icon">
            <i data-lucide="sparkles"></i>
          </div>
          <div class="ai-header-text">
            <h3>Insights</h3>
            <p>Flow to that A+ with smart recommendations</p>
          </div>
          <button class="btn-icon ai-refresh-btn" id="generateInsightsBtn" title="Refresh insights">
            <i data-lucide="refresh-cw"></i>
          </button>
        </div>
      </div>

      <div id="insightsContent">
        <div class="insights-placeholder">
          <i data-lucide="sparkles" style="width: 48px; height: 48px;"></i>
          <p>Your AI-powered insights will appear here</p>
          <p class="insights-placeholder-note">Get priority recommendations and a personalized study plan to help you focus on what matters most</p>
        </div>
      </div>
    </div>

    <!-- Calendar View Content -->
    <div class="ai-view-content" id="calendarViewContent" style="display: none;">
      <div class="ai-header-card">
        <div class="ai-header-card-inner">
          <div class="ai-header-icon">
            <i data-lucide="calendar"></i>
          </div>
          <div class="ai-header-text">
            <h3>This Week's Schedule</h3>
            <p>Stay in the flow - master your deadlines!</p>
          </div>
          <button class="btn-icon ai-refresh-btn" id="generateScheduleBtn" title="Refresh schedule">
            <i data-lucide="refresh-cw"></i>
          </button>
        </div>
      </div>

      <div id="scheduleContent">
        <div class="insights-placeholder">
          <i data-lucide="calendar" style="width: 48px; height: 48px;"></i>
          <p>Your AI-powered weekly study schedule will appear here</p>
          <p class="insights-placeholder-note">Get a personalized day-by-day breakdown of when to work on each assignment</p>
        </div>
      </div>
    </div>
  </div>

  <!-- Settings Modal -->
  <div class="modal-overlay" id="settingsModal">
    <div class="modal-content">
      <div class="modal-header">
        <h2 class="modal-title">Settings</h2>
        <button class="modal-close" id="closeSettingsModal">
          <i data-lucide="x"></i>
        </button>
      </div>
      <div class="modal-body">
        <!-- Canvas URL Card -->
        <div class="settings-card">
          <div class="settings-card-title">Canvas Instance</div>
          <input type="text" class="canvas-url-input" id="canvasUrlInput" placeholder="https://canvas.university.edu">
          <div class="canvas-url-buttons">
            <button class="secondary small" id="saveCanvasUrl">Save</button>
            <button class="ghost small" id="autoDetectUrl">Auto-Detect</button>
          </div>
          <div class="status-message" id="canvasUrlStatus"></div>
        </div>

        <!-- Time Range Card -->
        <div class="settings-card">
          <div class="settings-card-title">Assignment Time Range</div>
          <p style="font-size: 12px; color: #6B7280; margin: 0 0 12px 0;">
            Control the time window for displayed assignments
          </p>
          <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px;">
            <div>
              <label style="font-size: 12px; color: #374151; display: block; margin-bottom: 6px;">Weeks Before</label>
              <input type="number" id="assignmentWeeksBefore" min="0" max="52" value="0" style="width: 100%; padding: 8px 12px; border: 1px solid #D1D5DB; border-radius: 6px; font-size: 13px;">
            </div>
            <div>
              <label style="font-size: 12px; color: #374151; display: block; margin-bottom: 6px;">Weeks After</label>
              <input type="number" id="assignmentWeeksAfter" min="1" max="52" value="2" style="width: 100%; padding: 8px 12px; border: 1px solid #D1D5DB; border-radius: 6px; font-size: 13px;">
            </div>
          </div>
        </div>

        <!-- Display Preferences Card -->
        <div class="settings-card">
          <div class="settings-card-title">Display Preferences</div>
          <div style="display: flex; flex-direction: column; gap: 12px;">
            <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
              <input type="checkbox" id="hideEndedTermsToggle" checked style="cursor: pointer;">
              <span style="font-size: 13px; color: #374151;">Auto-hide courses from past semesters</span>
            </label>
            <div style="display: flex; align-items: center; gap: 8px;">
              <span style="font-size: 13px; color: #374151;">Auto-refresh data</span>
              <select id="autoRefreshInterval" style="padding: 4px 8px; border: 1px solid #D1D5DB; border-radius: 4px; font-size: 13px; background: white; cursor: pointer;">
                <option value="0">Never</option>
                <option value="15">Every 15 min</option>
                <option value="30" selected>Every 30 min</option>
                <option value="60">Every hour</option>
              </select>
            </div>
          </div>
          <div id="coursesList" style="max-height: 180px; overflow-y: auto; border: 1px solid #E5E7EB; border-radius: 6px; padding: 8px; margin-top: 12px;">
            <div style="font-size: 12px; color: #9CA3AF; text-align: center; padding: 8px;">Loading courses...</div>
          </div>
        </div>

        <!-- Notifications Card -->
        <div class="settings-card">
          <div class="settings-card-title">Notifications</div>
          <p style="font-size: 12px; color: #6B7280; margin: 0 0 12px 0;">
            Get reminders about upcoming deadlines
          </p>
          <div style="display: flex; flex-direction: column; gap: 12px;">
            <div style="display: flex; align-items: center; gap: 12px;">
              <label style="display: flex; align-items: center; gap: 8px; cursor: pointer; flex: 1;">
                <input type="checkbox" id="notificationsEnabled" style="cursor: pointer;">
                <span style="font-size: 13px; color: #374151;">Enable deadline notifications</span>
              </label>
              <button id="testNotification" style="padding: 6px 12px; background: #F3F4F6; color: #374151; border: 1px solid #E5E7EB; border-radius: 6px; font-size: 12px; cursor: pointer; font-weight: 500;">
                Test Notification
              </button>
            </div>
            <div id="notificationSettings" style="display: none; padding-left: 32px; border-left: 2px solid #E5E7EB;">
              <div style="margin-bottom: 12px;">
                <label style="font-size: 12px; color: #374151; display: block; margin-bottom: 6px;">Notification Frequency</label>
                <select id="notificationFrequency" style="width: 100%; padding: 8px 12px; border: 1px solid #D1D5DB; border-radius: 6px; font-size: 13px; background: white; cursor: pointer;">
                  <option value="minimal">Minimal - Only overdue</option>
                  <option value="balanced" selected>Balanced - Daily summary</option>
                  <option value="aggressive">Aggressive - All deadlines</option>
                </select>
              </div>
              <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px;">
                <div>
                  <label style="font-size: 12px; color: #374151; display: block; margin-bottom: 6px;">Quiet Hours Start</label>
                  <input type="time" id="quietHoursStart" value="22:00" style="width: 100%; padding: 8px 12px; border: 1px solid #D1D5DB; border-radius: 6px; font-size: 13px;">
                </div>
                <div>
                  <label style="font-size: 12px; color: #374151; display: block; margin-bottom: 6px;">Quiet Hours End</label>
                  <input type="time" id="quietHoursEnd" value="08:00" style="width: 100%; padding: 8px 12px; border: 1px solid #D1D5DB; border-radius: 6px; font-size: 13px;">
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script src="lib/lucide.min.js"></script>
  <script src="lib/lucide-init.js"></script>
  <!-- Shared Modules -->
  <script src="lib/constants.js"></script>
  <script src="lib/utils.js"></script>
  <script src="lib/storage-manager.js"></script>
  <script src="lib/messaging.js"></script>
  <script src="lib/ui-components.js"></script>
  <script src="lib/assignment-processor.js"></script>
  <!-- AI Support -->
  <script src="lib/ai-schemas.js"></script>
  <script src="lib/ai-mappers.js"></script>
  <script src="lib/ai-router.js"></script>
  <script src="lib/ai-client.js"></script>
  <script src="sidepanel.js"></script>
</body>
</html>